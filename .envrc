if [[ -n "${IN_NIX_SHELL:-}" ]]; then
  # Already in a nix shell; avoid nesting.
  :
elif [[ -f "flake.nix" ]]; then
  # Prefer flake-based shell for this project.
  use flake
else
  # Fallback for non-flake setups.
  use nix
fi
